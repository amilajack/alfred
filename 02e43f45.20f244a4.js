(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{139:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return b}));var r=n(1),a=n(10),i=(n(0),n(173)),l={title:"Alfred - A Modular Toolchain for JavaScript",author:"Amila Welihinda",authorURL:"http://twitter.com/amilajack"},o={permalink:"/blog/2020/03/20/alfred",source:"@site/blog/2020-03-20-alfred.md",description:"## What is Alfred? TL;DR",date:"2020-03-20T00:00:00.000Z",tags:[],title:"Alfred - A Modular Toolchain for JavaScript",truncated:!1,nextItem:{title:"Hello World",permalink:"/blog/2017/10/24/new-version-1.0.0"}},s=[{value:"What is Alfred? TL;DR",id:"what-is-alfred-tldr",children:[]},{value:"The Problem",id:"the-problem",children:[]},{value:"Solution",id:"solution",children:[]},{value:"Challenges",id:"challenges",children:[]},{value:"Philosophy",id:"philosophy",children:[{value:"Two main philosophies",id:"two-main-philosophies",children:[]},{value:"<strong>Side 1</strong>",id:"side-1",children:[]},{value:"<strong>Side 2</strong>",id:"side-2",children:[]}]},{value:"Getting Started with Alfred",id:"getting-started-with-alfred",children:[]},{value:"Future Opportunities",id:"future-opportunities",children:[]}],c={rightToc:s};function b(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"what-is-alfred-tldr"},"What is Alfred? TL;DR"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"A solution for JS infrastructure complexity"),Object(i.b)("li",{parentName:"ul"},"An alternative to boilerplates"),Object(i.b)("li",{parentName:"ul"},"Different projects, different tools, same workflow"),Object(i.b)("li",{parentName:"ul"},"You choose the tools, Alfred will configure them"),Object(i.b)("li",{parentName:"ul"},"A framework for boilerplates / starter kits"),Object(i.b)("li",{parentName:"ul"},"Better tooling, out of the box"),Object(i.b)("li",{parentName:"ul"},"A solution to brittle JS infrastructure")),Object(i.b)("h2",{id:"the-problem"},"The Problem"),Object(i.b)("h4",{id:"js-tooling-is-brittle"},"JS Tooling is Brittle"),Object(i.b)("p",null,'"Looking at the issues on ',Object(i.b)("inlineCode",{parentName:"p"},"storybooks/storybook"),":"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"2,479 total issues"),Object(i.b)("li",{parentName:"ul"},'732 mention "webpack" (30%)'),Object(i.b)("li",{parentName:"ul"},'428 mention "babel" (17%)')),Object(i.b)("p",null,"That's crazy! Other keywords that come up that often would treated as requiring architectural change, but those are just for configuration.\""),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},'It\'s a little mind-boggling how many issues are purely for dealing with Babel or Webpack configuration. And those are by far some of the most frustrating issues to debug when you do run into them. So much time wasted. Makes you really understand the "zero config" movement.')),Object(i.b)("h4",{id:"incorrect-suboptimal-infrastructure"},"Incorrect, Suboptimal Infrastructure"),Object(i.b)("p",null,"Because infrastructure is so customizable, it is possible to misconfigure it. There are suboptimal configurations that come out of this. For example, it is common for libraries to ship compiled code and with polyfills. This is considered an anti pattern because this makes it harder for applications to optimize the code. Because Alfred knows if you are shipping an app or a library, it can publish your project in the way that follows best practices. Alfred workflows are standardized, alfred can easily figure out how to ship your app. Alfred encourages best practices, which are the default and work out of the box."),Object(i.b)("h2",{id:"solution"},"Solution"),Object(i.b)("p",null,"The solution is that tools should be able to configure themselves out of the box. Each tool should know how to configure itself so that it can be compatible with other tools the user is using. Configurations should be generated and not manually configured. Advanced users should be able to override generated configs. At a basic level, this is what Alfred does."),Object(i.b)("h4",{id:"skills"},"Skills"),Object(i.b)("p",null,"Alfred refers to pieces of infrastructure as 'skills'. Skills are wrappers around tooling that allows them to configure themselves with respect to other tools. A babel skill, for example, would add the ",Object(i.b)("inlineCode",{parentName:"p"},"babel-preset-react")," preset to its config if the user is using react. In other words, it will add the preset to the config if the react 'skill' is present. Alfred comes with skills out of the box."),Object(i.b)("p",null,"Here is an example of a skill:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const skill = {\n  name: 'eslint',\n  devDependencies: {\n    'eslint-config-airbnb': '18.0.0'\n  },\n  configs: [\n    {\n      alias: 'eslint',\n      filename: '.eslintrc.js',\n      config: {\n        plugins: [\n          'eslint-plugin-prettier'\n        ]\n      }\n    }\n  ],\n  transforms: {\n    react(eslintSkill) {\n      return eslintSkill\n        .extendConfig('eslint', {\n          plugins: [\n            'eslint-plugin-react'\n          ]\n        })\n        .addDevDeps({\n          'eslint-plugin-react': '7.18.0'\n        });\n    }\n  }\n};\n\nexport default skill;\n")),Object(i.b)("p",null,"Users can customize configs through Alfred's configs:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-json"}),'// package.json\n{\n  "alfred": {\n    // Extend a shared config\n    "extends": "alfred-config-web-app",\n    // Skills that override the default skills\n    "skills": [\n      "@alfred/skill-react"\n    ],\n    // Determine to install with NPM or Yarn\n    "npmClient": "yarn"\n  }\n}\n')),Object(i.b)("h4",{id:"entrypoints"},"Entrypoints"),Object(i.b)("p",null,"Alfred formalizes a concept of entry points, which are files that determine the project type and platform a project will run on. For example, the entry point ",Object(i.b)("inlineCode",{parentName:"p"},"src/app.browser.js")," will be built as a browser app. Entrypoints determine which skills should be used to act on the entry point for a specific subcommand. For example, when calling ",Object(i.b)("inlineCode",{parentName:"p"},"alfred run build"),", which bundler should be used among webpack, parcel, and rollup? In the case of a ",Object(i.b)("inlineCode",{parentName:"p"},"src/app.browser.js")," entry point, the ",Object(i.b)("inlineCode",{parentName:"p"},"@alfred/skill-rollup")," skill will be used. Multiple entry points allow different skills to work on each entrypoint."),Object(i.b)("h4",{id:"tasks"},"Tasks"),Object(i.b)("p",null,"'Tasks' are responsible for mapping skills to subcommands. The ",Object(i.b)("inlineCode",{parentName:"p"},"@alfred/skill-parcel")," skill should be mapped to the ",Object(i.b)("inlineCode",{parentName:"p"},"start")," and ",Object(i.b)("inlineCode",{parentName:"p"},"build")," subcommands. Tasks are responsible for registering a subcommand and resolving which skill should be used when given the skills in a user's project and a target, which is an entrypoint with a given environment."),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// @alfred/task-build\nexport default {\n  subcommand: 'build',\n  description: 'Build, optimize, and bundle assets in your app',\n  runForEachTarget: true,\n  resolveSkill(skills, target) {\n    // return whichever skill you want to resolve...\n  }\n};\n")),Object(i.b)("p",null,"Alfred ships with the following tasks:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"build")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"start")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"lint")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"format")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"test"))),Object(i.b)("h2",{id:"challenges"},"Challenges"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Boilerplates or 'starter kits' always come with 'hardcoded' dependencies that users are bound to and cannot easily change. There may be too many tools or too few tools. A solution to this is a modular toolchain"),Object(i.b)("li",{parentName:"ul"},"Making it easier to try new projects. New projects may require configuring infra in a different way. Learning a skill automates that process and lowers the barrier to entry of trying new infrastructure")),Object(i.b)("h2",{id:"philosophy"},"Philosophy"),Object(i.b)("h3",{id:"two-main-philosophies"},"Two main philosophies"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Side 1: Developers shouldn't have to worry about configs"),Object(i.b)("li",{parentName:"ul"},"Side 2: They should have to know about configs")),Object(i.b)("h3",{id:"side-1"},Object(i.b)("strong",{parentName:"h3"},"Side 1")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Tooling isn't something most developers should have to know about. We're all doing the same stuff. Parcel, Next and Gatsby doing this right")),Object(i.b)("h3",{id:"side-2"},Object(i.b)("strong",{parentName:"h3"},"Side 2")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},'"we started with CRA and..." is the answer to my "tell me about the build config?" question that lets me know the team I\'m working with is in the deepest, darkest of holes. They now own a stack nobody supports (least of all them) and are years from mastering.')),Object(i.b)("h4",{id:"alfred-philosophy"},"Alfred Philosophy"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Alfred plans to cater to both by allowing developers to override its configs"),Object(i.b)("li",{parentName:"ul"},"Pros of customizable configs",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Extensibility, application to wide variety of scenarios"))),Object(i.b)("li",{parentName:"ul"},"Cons",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Vulnerable to misconfiguration"),Object(i.b)("li",{parentName:"ul"},"Difficult to setup (why boilerplates are popular)")))),Object(i.b)("h2",{id:"getting-started-with-alfred"},"Getting Started with Alfred"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"# Create a new project\nNPM_CONFIG_REGISTRY=https://amilajack.com/registry npx alfred new project\ncd my-project\n\n# Build your project\nNPM_CONFIG_REGISTRY=https://amilajack.com/registry npx alfred run build\n")),Object(i.b)("h2",{id:"future-opportunities"},"Future Opportunities"),Object(i.b)("h4",{id:"publishing"},"Publishing"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"# Run command for specific entrypoints\nalfred entrypoint app.lib run build\n# Publish all entrypoints\nalfred publish\n# Publish app to GitHub pages\nalfred entrypoint app.browser publish --method github-pages\n")),Object(i.b)("h4",{id:"shared-plugins-among-tasks"},"Shared plugins among tasks"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Show example of ",Object(i.b)("inlineCode",{parentName:"li"},"alfred-plugin-size")," package")),Object(i.b)("h4",{id:"shared-ast-between-tools"},"Shared AST between tools"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Requires lower level integration of tools (they need to take an AST as input and return one as output)"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(r.a)({parentName:"li"},{href:"https://romejs.dev/"}),"Rome")," is already doing this!"),Object(i.b)("li",{parentName:"ul"},"Leveraging types across all tools")))}b.isMDXComponent=!0},173:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var r=n(0),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=a.a.createContext({}),b=function(e){var t=a.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o({},t,{},e)),n},u=function(e){var t=b(e.components);return a.a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=b(n),d=r,h=u["".concat(l,".").concat(d)]||u[d]||p[d]||i;return n?a.a.createElement(h,o({ref:t},c,{components:n})):a.a.createElement(h,o({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var c=2;c<i;c++)l[c]=n[c];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);